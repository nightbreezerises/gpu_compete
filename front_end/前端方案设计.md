# GPU 管理器前端方案设计

## 一、系统概述

基于 React + Vite 构建的 GPU 管理器前端界面，仿照 clash-dashboard 风格设计，提供可视化的 GPU 监控和配置管理功能。

**访问地址**：`http://{host}:{port}/ui`

## 二、目录结构

```
src/dashboard/
├── vite.config.js           # Vite 配置（base: '/ui/'）
├── package.json             # 依赖配置
├── index.html               # HTML 入口
└── src/
    ├── main.jsx             # React 入口
    ├── index.css            # 全局样式
    ├── App.jsx              # 路由配置
    ├── context/             # 上下文
    │   └── AuthContext.jsx  # 认证上下文
    ├── components/          # 公共组件
    │   ├── Layout.jsx       # 布局组件
    │   ├── Sidebar.jsx      # 侧边栏
    │   ├── LoginModal.jsx   # 登录模态框
    │   ├── ProgressBar.jsx  # 进度条
    │   └── GpuCard.jsx      # GPU 卡片
    └── pages/               # 页面组件
        ├── GpuPage.jsx      # GPU 监控页
        ├── CommandPage.jsx  # 命令配置页
        ├── StatusPage.jsx   # 状态页
        ├── RulePage.jsx     # 规则配置页
        └── SettingPage.jsx  # 系统设置页
```

## 三、路由配置

| 路径 | 页面 | 说明 |
|------|------|------|
| `/ui` | 重定向 | 自动跳转到 `/ui/gpu` |
| `/ui/gpu` | GpuPage | GPU 实时监控 |
| `/ui/command` | CommandPage | 命令配置管理 |
| `/ui/status` | StatusPage | 服务状态 |
| `/ui/rule` | RulePage | 规则配置 |
| `/ui/setting` | SettingPage | 系统设置 |

## 四、认证机制

### AuthContext 认证上下文

```javascript
// 提供的功能
{
  isAuthenticated,      // 是否已认证
  password,             // 当前密码
  setPassword,          // 设置密码
  showLoginModal,       // 是否显示登录框
  authenticate,         // 认证函数
  checkAuth,            // 检查认证状态
  authenticatedFetch,   // 请求函数（无需认证头）
  logout                // 登出函数
}
```

### 登录流程（类似 clash-dashboard）

1. **检查认证**：页面加载时调用 `GET /api/auth/check`
2. **无需认证**：如果 `requires_auth: false`，直接进入主界面
3. **需要认证**：如果 `requires_auth: true`，显示登录模态框
4. **登录验证**：用户输入密钥，调用 `POST /api/auth/login` 验证
5. **认证成功**：关闭模态框，记录认证状态，正常使用

**密钥来源**：`front_end/config.yaml` 中的 `secret` 字段

**测试验证**：
```bash
# 检查是否需要认证
curl http://localhost:29214/api/auth/check
# 返回: {"requires_auth": true}

# 登录验证（正确密钥）
curl -X POST http://localhost:29214/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"password": "omniai315fgvr_gpu_config"}'
# 返回: {"success": true, "message": "登录成功"}

# 登录验证（错误密钥）
curl -X POST http://localhost:29214/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"password": "wrong"}'
# 返回: {"success": false, "message": "密码错误"}
```

### 登录界面风格（仿 clash-dashboard）

- 半透明遮罩层 + 模糊背景效果
- 单一登录卡片（GPU 图片 + 标题 + 输入框 + 按钮）
- 仅密钥输入框，无用户名标签
- 蓝色主题色 `#2c8af8`
- GPU 图标：80x80px 圆角图片，使用 `/ui/images/gpu.jpg`
- 渐变按钮和阴影效果
- 错误提示红色警告框

**视觉元素**：
- **GPU 图标**：真实 GPU 图片（80x80px，圆角阴影）
- **标题**：蓝色字体 `#2c8af8`，22px
- **副标题**：灰色 "登录以访问此站点"
- **输入框**：placeholder "请输入访问密钥"，聚焦时蓝色边框
- **按钮**：蓝色渐变背景 + 悬停动画效果

## 五、页面设计

### 1. 布局组件 (Layout)

```
┌─────────────────────────────────────────┐
│  ┌──────┐                               │
│  │ GPU  │  GPU                          │
│  │ 图片 │                               │
│  ├──────┤  ┌─────────────────────────┐  │
│  │ GPU  │  │                         │  │
│  │ 命令 │  │      页面内容区域        │  │
│  │ 状态 │  │      (Outlet)           │  │
│  │ 规则 │  │                         │  │
│  │ 设置 │  │                         │  │
│  ├──────┤  └─────────────────────────┘  │
│  │v1.0.0│                               │
│  └──────┘                               │
└─────────────────────────────────────────┘
```

### 2. GPU 监控页 (GpuPage)

**功能**：
- 实时显示 GPU 使用情况
- 刷新率控制（0.5s/1s/2s/5s）
- 概览卡片（GPU数量、进程数、显存使用、活跃用户）
- 主机信息（主机名、CPU、内存）
- GPU 卡片网格（利用率、显存、温度、功耗、进程）

**样式**：
- 蓝色标题 `#2c8af8`
- 卡片阴影 `2px 5px 20px -3px rgba(44,138,248,0.18)`
- 进度条颜色根据使用率变化

### 3. 命令配置页 (CommandPage)

**功能**：
- 单卡/多卡模式切换
- 队列管理（添加、删除、折叠）
- 进程管理（添加、删除、配置）
- 命令编辑（添加、删除、修改）
- 保存/重置配置

**组件**：
- QueueCard：队列卡片
- ProcessCard：进程卡片

### 4. 规则页 (RulePage)

**功能**：
- 查看和修改 `config.yaml` 中的规则配置
- 支持实时保存和验证

**UI 设计 (仿 clash-dashboard)**：
- **布局**：双栏 Grid 布局，铺满全屏，移除全局 `max-width` 限制。采用卡片式设计，每个配置分组包裹在白色圆角卡片中，左右两栏间距加大以增强视觉分离。
- **分组**：基础设置、模式选择、高级配置、重试机制（独立卡片包裹）
- **样式**：
  - 每一行一个配置项，左侧标题/描述，右侧控件
  - 底部固定悬浮按钮栏 (Glassmorphism 效果)
  - 现代化的开关组件 (Toggle Switch)
  - 右对齐的输入框

### 5. 设置页 (SettingPage)

**功能**：
- 修改系统运行参数（端口、日志、密钥等）
- 提示需要重启的选项

**UI 设计**：
- 与规则页保持一致的双栏 Grid 布局和卡片式设计，全宽显示，无边距限制
- 分组展示：通用、网络、安全
- 警告提示优化（黄色背景条）

## 六、样式规范

### 颜色系统
- **主色 (Primary)**: `#2c8af8` (蓝色)
- **成功 (Success)**: `#52c41a` (绿色)
- **警告 (Warning)**: `#faad14` (橙色)
- **错误 (Error)**: `#ff4d4f` (红色)
- **文本 (Text)**: `#333333` (主要), `#999999` (次要)
- **边框 (Border)**: `#f0f0f0` (分隔线), `#d9d9d9` (输入框)
- **背景 (Background)**: `#ffffff` (卡片/内容), `#f9fafb` (输入框背景)

### 组件样式
- **输入框**: 右对齐，无边框感（或极细边框），聚焦时无明显轮廓但有颜色变化
- **开关**: iOS 风格 Toggle Switch
- **按钮**: 圆角胶囊样式 (Border Radius 18px)，悬停浮动效果

## 七、API 接口调用

### 6. 状态页 (StatusPage)

**功能**：
- 服务状态监控（开发中）

## 六、公共组件

### ProgressBar 进度条

```jsx
<ProgressBar 
  value={75}        // 当前值
  max={100}         // 最大值
  color="#2c8af8"   // 颜色
  height={8}        // 高度
  showText={true}   // 显示百分比
/>
```

### GpuCard GPU 卡片

显示单个 GPU 的详细信息：
- GPU 索引和名称
- 温度（颜色随温度变化）
- GPU 利用率进度条
- 显存使用进度条
- 功耗信息
- 进程列表

### LoginModal 登录模态框

- 半透明背景遮罩
- 居中登录卡片
- 密钥输入框
- 连接按钮
- 错误提示

## 七、样式规范

### 颜色

| 用途 | 颜色 |
|------|------|
| 主色 | `#2c8af8` |
| 渐变 | `linear-gradient(135deg, #57befc, #2c8af8)` |
| 成功 | `#5dae34` / `#67c23a` |
| 警告 | `#f59e0b` / `#f97316` |
| 错误 | `#f56c6c` / `#e74c3c` |
| 文字 | `#24292e` / `#54759a` |
| 边框 | `#e4eaef` |
| 背景 | `#f4f5f6` |

### 阴影

```css
/* 卡片阴影 */
box-shadow: 2px 5px 20px -3px rgba(44,138,248,0.18);

/* 按钮阴影 */
box-shadow: 0 2px 8px rgba(44,138,248,0.4);

/* 标题阴影 */
text-shadow: 0 2px 6px rgba(44,138,248,0.4);
```

### 按钮样式

```css
/* 主按钮 */
background: linear-gradient(135deg, #57befc, #2c8af8);
color: #fff;
border: none;
border-radius: 3px;

/* 次按钮 */
background: #fff;
color: #54759a;
border: 1px solid #e4eaef;
```

### 输入框样式

```css
height: 36px;
padding: 0 12px;
border: 1px solid #e4eaef;
border-radius: 4px;
transition: all 0.3s ease;

/* 聚焦状态 */
border-color: #57befc;
box-shadow: 0 0 0 2px rgba(87, 190, 252, 0.2);
```

## 八、依赖

```json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.20.0"
  }
}
```

## 九、构建配置

```javascript
// vite.config.js
export default defineConfig({
  plugins: [react()],
  base: '/ui/',
  build: {
    outDir: 'dist',
  },
})
```

## 十、更新日志

### v1.2.0 (2025-12-02)

- **认证重构**：移除 HTTP Basic Auth，改用自定义密钥认证
- **无用户名**：登录界面仅显示密钥输入框，类似 clash-dashboard
- **API 调整**：使用 `/api/auth/check` 和 `/api/auth/login` 进行认证
- **登录美化**：GPU 图片图标 + 蓝色标题 + 模糊背景 + 渐变按钮
- **API 无认证**：所有业务 API 移除认证要求，仅登录需要验证
- **视觉升级**：使用真实 GPU 图片替代文字图标，界面更专业

### v1.1.0 (2025-12-02)

- **路由重构**：访问路径从 `/` 改为 `/ui`
- **文件拆分**：将 App.jsx 拆分为多个页面和组件文件
- **认证优化**：支持无密码直接访问，有密码显示模态框
- **样式统一**：仿照 clash-dashboard 风格
- **移除卡片**：规则和设置页面移除多余卡片包裹
- **标题统一**：所有页面标题使用蓝色风格
